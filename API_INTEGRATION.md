# å‰åç«¯è”è°ƒé…ç½®è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜äº†æ‰‹åŠ¿é£æœºå¤§æˆ˜æ¸¸æˆå‰ç«¯ä¸åç«¯APIçš„è”è°ƒé…ç½®ã€‚

## ğŸ”§ é…ç½®å˜æ›´

### 1. ç¯å¢ƒå˜é‡æ›´æ–°

**å¼€å‘ç¯å¢ƒ** (`.env.development`):
```
VITE_API_BASE_URL=http://localhost:3000
```

**ç”Ÿäº§ç¯å¢ƒ** (`.env.production`):
```
VITE_API_BASE_URL=https://api.yourdomain.com
```

### 2. Mockæ•°æ®ç¦ç”¨

åœ¨ `src/main.tsx` ä¸­å·²æ³¨é‡Šæ‰Mock.jsï¼š
```typescript
// import '../mock/index' // æš‚æ—¶æ³¨é‡Šæ‰ mockjsï¼Œä½¿ç”¨çœŸå®çš„ Node.js æœåŠ¡å™¨
```

### 3. æ–°å¢å·¥å…·å‡½æ•°

**è®¾å¤‡IDå·¥å…·** (`src/utils/deviceUtils.ts`):
- `generateDeviceId()`: ç”Ÿæˆ32ä½åå…­è¿›åˆ¶è®¾å¤‡ID
- `validateDeviceId()`: éªŒè¯è®¾å¤‡IDæ ¼å¼
- `getOrCreateDeviceId()`: è·å–æˆ–åˆ›å»ºè®¾å¤‡IDï¼ˆè‡ªåŠ¨å­˜å‚¨åˆ°localStorageï¼‰
- `clearDeviceId()`: æ¸…é™¤è®¾å¤‡ID

## ğŸš€ APIæ¥å£é€‚é…

### 1. æäº¤æ¸¸æˆæˆç»©

**åŸæ¥å£**: `/api/rank/submit`
**æ–°æ¥å£**: `/api/game/submit`

**è¯·æ±‚æ•°æ®å˜æ›´**:
```typescript
// åŸæ ¼å¼
{
  score: number,
  level: number,
  duration: number,
  timestamp: number,
  playerName: string
}

// æ–°æ ¼å¼
{
  deviceId: string,  // 32ä½åå…­è¿›åˆ¶è®¾å¤‡ID
  score: number      // æ¸¸æˆåˆ†æ•°
}
```

**å“åº”æ•°æ®å˜æ›´**:
```typescript
// æ–°å“åº”æ ¼å¼
{
  success: boolean,
  data: {
    recordId: string,
    isNewBest: boolean,
    currentBest: number,
    message: string
  },
  timestamp: number
}
```

### 2. è·å–æ’è¡Œæ¦œ

**æ¥å£åœ°å€**: `GET /api/game/ranking`

**æŸ¥è¯¢å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|------|--------|------|
| type | string | å¦ | all | æ’è¡Œæ¦œç±»å‹: `all`(æ€»æ¦œ) æˆ– `weekly`(å‘¨æ¦œ) |

**è¯·æ±‚ç¤ºä¾‹**:
```bash
# è·å–æ€»æ¦œå‰å
curl "http://localhost:3000/api/game/ranking?type=all"

# è·å–å‘¨æ¦œå‰å
curl "http://localhost:3000/api/game/ranking?type=weekly"
```

**å“åº”æ•°æ®æ ¼å¼**:
```typescript
{
  success: boolean,
  data: {
    type: string,
    rankings: Array<{
      rank: number,
      deviceId: string,
      score: number,
      updatedAt: string
    }>,
    count: number
  },
  timestamp: number
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "data": {
    "type": "all",
    "rankings": [
      {
        "rank": 1,
        "deviceId": "abc123def456ghi789jkl012mno345pq",
        "score": 25600,
        "updatedAt": "2024-01-15T10:30:00.000Z"
      },
      {
        "rank": 2,
        "deviceId": "def456ghi789jkl012mno345pqabc123",
        "score": 23400,
        "updatedAt": "2024-01-14T15:20:00.000Z"
      }
    ],
    "count": 10
  },
  "timestamp": 1703123456789
}
```

### 3. ä¸ªäººä¿¡æ¯æ¥å£

ç›®å‰APIæ–‡æ¡£ä¸­æ²¡æœ‰ä¸ªäººä¿¡æ¯æ¥å£ï¼Œæ’è¡Œæ¦œé¡µé¢çš„ä¸ªäººä¿¡æ¯éƒ¨åˆ†æš‚æ—¶ä½¿ç”¨é»˜è®¤å€¼ã€‚



## ğŸ“Š æ•°æ®æµç¨‹

### æ¸¸æˆæˆç»©æäº¤æµç¨‹

1. æ¸¸æˆç»“æŸæ—¶è‡ªåŠ¨è·å–æˆ–ç”Ÿæˆè®¾å¤‡ID
2. è°ƒç”¨ `/api/game/submit` æäº¤æˆç»©
3. åç«¯è¿”å›æ˜¯å¦ä¸ºæ–°çºªå½•çš„ä¿¡æ¯
4. å‰ç«¯æ ¹æ®ç»“æœæ˜¾ç¤ºç›¸åº”æç¤º

### æ’è¡Œæ¦œè·å–æµç¨‹

1. è¿›å…¥æ’è¡Œæ¦œé¡µé¢
2. æ ¹æ®é€‰æ‹©çš„æ¦œå•ç±»å‹è°ƒç”¨ç›¸åº”æ¥å£
3. æ¸²æŸ“æ’è¡Œæ¦œæ•°æ®ï¼Œå‰ä¸‰åæ˜¾ç¤ºå¥–ç‰Œå›¾æ ‡
4. ç©å®¶åç§°æ˜¾ç¤ºä¸º"ç©å®¶{è®¾å¤‡IDå‰8ä½}"

## ğŸ” è°ƒè¯•å»ºè®®

1. **æ£€æŸ¥ç½‘ç»œè¯·æ±‚**: ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹Networké¢æ¿
2. **æŸ¥çœ‹æ§åˆ¶å°**: æ£€æŸ¥æ˜¯å¦æœ‰JavaScripté”™è¯¯
3. **éªŒè¯è®¾å¤‡ID**: åœ¨localStorageä¸­æŸ¥çœ‹ `gesture_game_device_id`

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **è®¾å¤‡IDæ ¼å¼**: å¿…é¡»æ˜¯32ä½åå…­è¿›åˆ¶å­—ç¬¦ä¸² `[a-f0-9]{32}`
2. **åˆ†æ•°èŒƒå›´**: 0-999999
3. **CORSé…ç½®**: ç¡®ä¿åç«¯æ­£ç¡®é…ç½®CORS
4. **é”™è¯¯å¤„ç†**: æ‰€æœ‰APIè°ƒç”¨éƒ½æœ‰é”™è¯¯å¤„ç†æœºåˆ¶
5. **æœ¬åœ°å­˜å‚¨**: è®¾å¤‡IDä¼šè‡ªåŠ¨å­˜å‚¨åœ¨localStorageä¸­

## ğŸš€ å¯åŠ¨æ­¥éª¤

1. **å¯åŠ¨åç«¯æœåŠ¡**: ç¡®ä¿åç«¯æœåŠ¡è¿è¡Œåœ¨ `http://localhost:3000`
2. **å¯åŠ¨å‰ç«¯æœåŠ¡**: è¿è¡Œ `pnpm dev`
3. **å¼€å§‹æ¸¸æˆ**: æ­£å¸¸æ¸¸æˆæµç¨‹ï¼Œæˆç»©ä¼šè‡ªåŠ¨æäº¤åˆ°åç«¯

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ¥å£404é”™è¯¯**: æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨
2. **CORSé”™è¯¯**: æ£€æŸ¥åç«¯CORSé…ç½®
3. **è®¾å¤‡IDæ ¼å¼é”™è¯¯**: æ¸…é™¤localStorageé‡æ–°ç”Ÿæˆ
4. **ç½‘ç»œè¶…æ—¶**: æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œåç«¯æœåŠ¡çŠ¶æ€

### è§£å†³æ–¹æ¡ˆ

1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
2. éªŒè¯ç¯å¢ƒå˜é‡é…ç½®
3. ç¡®è®¤åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ